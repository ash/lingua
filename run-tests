#!/usr/bin/env raku

use Test;

my @errors;

test-file($_) for dir('t').sort;

done-testing;

sub test-file($file) {
    my $path = $file.path;

    my $proc = run('./lingua', $path, :out, :err);
    my $out = $proc.out.slurp;

    my $expected = expected($path);
    is($expected, $out, $path);
}

sub expected($path) {
    my $expected;
    for $path.IO.lines -> $line {
        $line ~~ /'##'\s*(\N*)/;
        next unless $0;
        $expected ~= "$0\n";
    }

    return $expected;
}
